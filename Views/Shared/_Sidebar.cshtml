@using DMS_CPMS.Data.Models
@using Microsoft.AspNetCore.Identity
@inject SignInManager<ApplicationUser> SignInManager
@inject UserManager<ApplicationUser> UserManager

@{
    var isAuthenticated = User.Identity?.IsAuthenticated ?? false;
    var currentController = ViewContext.RouteData.Values["Controller"]?.ToString();
    var currentAction = ViewContext.RouteData.Values["Action"]?.ToString();
    var isSuperAdmin = User.IsInRole("SuperAdmin");
    var isAdmin = User.IsInRole("Admin");
    var isStaff = User.IsInRole("Staff");
}

@if (isAuthenticated)
{
    <nav class="sidebar" id="sidebar" role="navigation" aria-label="Main navigation">
        <div class="sidebar-toggle" id="sidebarToggle" title="Toggle sidebar">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="3" y1="12" x2="21" y2="12"></line>
                <line x1="3" y1="6" x2="21" y2="6"></line>
                <line x1="3" y1="18" x2="21" y2="18"></line>
            </svg>
        </div>
        <div class="sidebar-logo">
            <img src="~/images/logo.png" alt="Clinic DMS Logo" class="sidebar-logo-img" />
        </div>
        <div class="sidebar-header">
            <span class="sidebar-title">Clinic DMS</span>
        </div>
        <ul class="sidebar-menu list-unstyled">
            <li class="sidebar-item @(currentController == "Dashboard" && (currentAction == "Index" || currentAction == null) ? "active" : "")">
                @if (isSuperAdmin)
                {
                    <a href="@Url.Action("Index", "Dashboard", new { area = "SuperAdmin" })" class="sidebar-link">
                        <span class="sidebar-link-icon" aria-hidden="true">
                            <svg viewBox="0 0 20 20" focusable="false">
                                <rect x="2" y="2" width="7" height="7" rx="1" fill="currentColor"></rect>
                                <rect x="11" y="2" width="7" height="7" rx="1" fill="currentColor"></rect>
                                <rect x="2" y="11" width="7" height="7" rx="1" fill="currentColor"></rect>
                                <rect x="11" y="11" width="7" height="7" rx="1" fill="currentColor"></rect>
                            </svg>
                        </span>
                        <span class="sidebar-link-text">Dashboard</span>
                    </a>
                }
                else if (isAdmin)
                {
                    <a href="@Url.Action("Index", "Dashboard", new { area = "Admin" })" class="sidebar-link">
                        <span class="sidebar-link-icon" aria-hidden="true">
                            <svg viewBox="0 0 20 20" focusable="false">
                                <rect x="2" y="2" width="7" height="7" rx="1" fill="currentColor"></rect>
                                <rect x="11" y="2" width="7" height="7" rx="1" fill="currentColor"></rect>
                                <rect x="2" y="11" width="7" height="7" rx="1" fill="currentColor"></rect>
                                <rect x="11" y="11" width="7" height="7" rx="1" fill="currentColor"></rect>
                            </svg>
                        </span>
                        <span class="sidebar-link-text">Dashboard</span>
                    </a>
                }
                else if (isStaff)
                {
                    <a href="@Url.Action("Index", "Dashboard", new { area = "Staff" })" class="sidebar-link">
                        <span class="sidebar-link-icon" aria-hidden="true">
                            <svg viewBox="0 0 20 20" focusable="false">
                                <rect x="2" y="2" width="7" height="7" rx="1" fill="currentColor"></rect>
                                <rect x="11" y="2" width="7" height="7" rx="1" fill="currentColor"></rect>
                                <rect x="2" y="11" width="7" height="7" rx="1" fill="currentColor"></rect>
                                <rect x="11" y="11" width="7" height="7" rx="1" fill="currentColor"></rect>
                            </svg>
                        </span>
                        <span class="sidebar-link-text">Dashboard</span>
                    </a>
                }
            </li>

            @if (isStaff)
            {
                <li class="sidebar-item @(currentAction == "Patients" ? "active" : "")">
                    <a href="/Staff/Dashboard/Patients" class="sidebar-link">
                        <span class="sidebar-link-icon" aria-hidden="true">
                            <svg viewBox="0 0 20 20" focusable="false">
                                <circle cx="10" cy="6" r="3" fill="currentColor"></circle>
                                <path d="M4 16c0-2.2 2.2-4 6-4s6 1.8 6 4H4z" fill="currentColor"></path>
                            </svg>
                        </span>
                        <span class="sidebar-link-text">Patient Records</span>
                    </a>
                </li>

                <li class="sidebar-item @(currentAction == "ArchiveRetention" ? "active" : "")">
                    <a href="/Staff/Dashboard/ArchiveRetention" class="sidebar-link">
                        <span class="sidebar-link-icon" aria-hidden="true">
                            <svg viewBox="0 0 20 20" focusable="false">
                                <path d="M4 4h12v12H4z" fill="none" stroke="currentColor" stroke-width="2"/>
                                <path d="M8 10h4M8 14h4" stroke="currentColor" stroke-width="2"/>
                                <path d="M2 6h2M2 10h2M2 14h2" stroke="currentColor" stroke-width="2"/>
                            </svg>
                        </span>
                        <span class="sidebar-link-text">Document Archive</span>
                    </a>
                </li>
            }

            @if (isSuperAdmin || isAdmin)
            {
                <li class="sidebar-item @(currentController == "Accounts" ? "active" : "")">
                    @if (isSuperAdmin)
                    {
                        <a href="@Url.Action("Index", "Accounts", new { area = "SuperAdmin" })" class="sidebar-link">
                            <span class="sidebar-link-icon" aria-hidden="true">
                                <svg viewBox="0 0 20 20" focusable="false">
                                    <circle cx="10" cy="6" r="3" fill="currentColor"></circle>
                                    <path d="M4 16c0-2.2 2.2-4 6-4s6 1.8 6 4H4z" fill="currentColor"></path>
                                </svg>
                            </span>
                            <span class="sidebar-link-text">Accounts</span>
                        </a>
                    }
                    else if (isAdmin)
                    {
                        <a href="@Url.Action("Index", "Accounts", new { area = "Admin" })" class="sidebar-link">
                            <span class="sidebar-link-icon" aria-hidden="true">
                                <svg viewBox="0 0 20 20" focusable="false">
                                    <circle cx="10" cy="6" r="3" fill="currentColor"></circle>
                                    <path d="M4 16c0-2.2 2.2-4 6-4s6 1.8 6 4H4z" fill="currentColor"></path>
                                </svg>
                            </span>
                            <span class="sidebar-link-text">Accounts</span>
                        </a>
                    }
                </li>

                <li class="sidebar-item @(currentController == "Patient" ? "active" : "")">
                    <a href="@Url.Action("Index", "Patient", new { area = "" })" class="sidebar-link">
                        <span class="sidebar-link-icon" aria-hidden="true">
                            <svg viewBox="0 0 20 20" focusable="false">
                                <path d="M10 4.5c-1.8-2.5-6-1.8-6 1.8 0 3.1 4.8 5.8 6 7 1.2-1.2 6-3.9 6-7 0-3.6-4.2-4.3-6-1.8z" fill="currentColor"></path>
                            </svg>
                        </span>
                        <span class="sidebar-link-text">Patients</span>
                    </a>
                </li>

                <li class="sidebar-item @(currentController == "ArchiveRetention" ? "active" : "")">
                    <a href="@Url.Action("Index", "ArchiveRetention", new { area = "" })" class="sidebar-link">
                        <span class="sidebar-link-icon" aria-hidden="true">
                            <svg viewBox="0 0 20 20" focusable="false">
                                <path d="M4 4h12v12H4z" fill="none" stroke="currentColor" stroke-width="2"/>
                                <path d="M8 10h4M8 14h4" stroke="currentColor" stroke-width="2"/>
                                <path d="M2 6h2M2 10h2M2 14h2" stroke="currentColor" stroke-width="2"/>
                            </svg>
                        </span>
                        <span class="sidebar-link-text">Archive & Retention</span>
                    </a>
                </li>

                <li class="sidebar-item @(currentAction == "ActivityLogs" ? "active" : "")">
                    @if (isSuperAdmin)
                    {
                        <a href="/SuperAdmin/Dashboard/ActivityLogs" class="sidebar-link">
                            <span class="sidebar-link-icon" aria-hidden="true">
                                <svg viewBox="0 0 20 20" focusable="false">
                                    <circle cx="10" cy="10" r="7" fill="none" stroke="currentColor" stroke-width="2"/>
                                    <path d="M10 6v5l3 3" stroke="currentColor" stroke-width="2" fill="none"/>
                                </svg>
                            </span>
                            <span class="sidebar-link-text">Activity Logs</span>
                        </a>
                    }
                    else if (isAdmin)
                    {
                        <a href="/Admin/Dashboard/ActivityLogs" class="sidebar-link">
                            <span class="sidebar-link-icon" aria-hidden="true">
                                <svg viewBox="0 0 20 20" focusable="false">
                                    <circle cx="10" cy="10" r="7" fill="none" stroke="currentColor" stroke-width="2"/>
                                    <path d="M10 6v5l3 3" stroke="currentColor" stroke-width="2" fill="none"/>
                                </svg>
                            </span>
                            <span class="sidebar-link-text">Activity Logs</span>
                        </a>
                    }
                </li>
            }
        </ul>
    </nav>

    <script>
        (function() {
            const sidebar = document.getElementById('sidebar');
            const desktopToggle = document.getElementById('sidebarToggle');
            const mobileToggle = document.getElementById('mobileMenuToggle');
            
            // Create overlay element for mobile slide mode (if needed)
            let overlay = document.querySelector('.sidebar-overlay');
            if (!overlay) {
                overlay = document.createElement('div');
                overlay.className = 'sidebar-overlay';
                overlay.id = 'sidebarOverlay';
                document.body.appendChild(overlay);
            }
            
            // Check for saved state (applies to both desktop and mobile)
            const isCollapsed = localStorage.getItem('sidebarCollapsed') === 'true';
            if (isCollapsed) {
                sidebar.classList.add('collapsed');
            }
            
            // Desktop toggle - shrink/expand
            if (desktopToggle) {
                desktopToggle.addEventListener('click', function() {
                    sidebar.classList.toggle('collapsed');
                    const collapsed = sidebar.classList.contains('collapsed');
                    localStorage.setItem('sidebarCollapsed', collapsed);
                });
            }
            
            // Mobile toggle - same shrink/expand behavior
            if (mobileToggle && sidebar) {
                mobileToggle.addEventListener('click', function() {
                    sidebar.classList.toggle('collapsed');
                    const collapsed = sidebar.classList.contains('collapsed');
                    localStorage.setItem('sidebarCollapsed', collapsed);
                    mobileToggle.setAttribute('aria-expanded', !collapsed);
                });
            }
        })();
    </script>
}

